FROM ruby:2.2.3

# Environment variables
ENV APP_HOME=/lunchiatto

# deps
RUN apt-get update -qq && apt-get install -y build-essential nodejs npm nodejs-legacy

# install bower
RUN npm install -g bower

COPY Gemfile* /tmp/
WORKDIR /tmp
RUN bundle install --jobs 20

# setup the directory
RUN mkdir $APP_HOME
WORKDIR $APP_HOME

#copy code
ADD . $APP_HOME

#install bower
RUN bower install --allow-root --save --force-latest

#precompile assets
RUN rake assets:precompile
